<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="/css/button.css">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="/css/section.css">
    <link rel="stylesheet" type="text/css" href="/css/typography.css">

    <link rel="icon" type="image/png" href="/images/favicon.png">
    
    <title>Device and WiFi Info</title>
    <style>
    </style>
</head>

<body>
    <div class="buttonNavigation-container">
        <a class="buttonNavigation" type="home" href="/">Home</a>
    </div>
    <div id="deviceInfo" class="section-box">
        <h2>Device Info</h2>
        <h3>System</h3>
        <p><span class='list-key'>Uptime:</span><span id='uptime' class='list-value'></span> ms</p>
        <p><span class='list-key'>Uptime:</span><span id='uptimeDays' class='list-value'></span> days</p>
        <h3>Firmware</h3>
        <p><span class='list-key'>Version:</span><span id='firmwareVersion' class='list-value'></span></p>
        <p><span class='list-key'>Date:</span><span id='firmwareDate' class='list-value'></span></p>
        <h3>Filesystem</h3>
        <p><span class='list-key'>Version:</span><span id='filesystemVersion' class='list-value'></span></p>
        <p><span class='list-key'>Date:</span><span id='filesystemDate' class='list-value'></span></p>
        <h3>Memory</h3>
        <h4>Heap</h4>
        <p><span class='list-key'>Free:</span><span id='heapFree' class='list-value'></span> kB</p>
        <p><span class='list-key'>Total:</span><span id='heapTotal' class='list-value'></span> kB</p>
        <h4>Flash</h4>
        <p><span class='list-key'>Free:</span><span id='flashFree' class='list-value'></span> kB</p>
        <p><span class='list-key'>Total:</span><span id='flashTotal' class='list-value'></span> kB</p>
        <h4>Spiffs</h4>
        <p><span class='list-key'>Free:</span><span id='spiffsFree' class='list-value'></span> kB</p>
        <p><span class='list-key'>Total:</span><span id='spiffsTotal' class='list-value'></span> kB</p>
        <h3>Chip</h3>
        <p><span class='list-key'>Model:</span><span id='chipModel' class='list-value'></span></p>
        <p><span class='list-key'>Revision:</span><span id='chipRevision' class='list-value'></span></p>
        <p><span class='list-key'>CPU Frequency:</span><span id='chipCpuFrequency' class='list-value'></span> MHz</p>
        <p><span class='list-key'>SDK Version:</span><span id='chipSdkVersion' class='list-value'></span></p>
        <p><span class='list-key'>Flash Chip ID:</span><span id='chipFlashChipId' class='list-value'></span></p>
    </div>
    <div id="wifiInfo" class="section-box">
        <h2>WiFi Info</h2>
        <p><span class='list-key'>MAC Address:</span><span id='macAddress' class='list-value'></span></p>
        <p><span class='list-key'>Local IP:</span><span id='localIp' class='list-value'></span></p>
        <p><span class='list-key'>Subnet Mask:</span><span id='subnetMask' class='list-value'></span></p>
        <p><span class='list-key'>Gateway IP:</span><span id='gatewayIp' class='list-value'></span></p>
        <p><span class='list-key'>DNS IP:</span><span id='dnsIp' class='list-value'></span></p>
        <p><span class='list-key'>Status:</span><span id='status' class='list-value'></span></p>
        <p><span class='list-key'>SSID:</span><span id='ssid' class='list-value'></span></p>
        <p><span class='list-key'>BSSID:</span><span id='bssid' class='list-value'></span></p>
        <p><span class='list-key'>RSSI:</span><span id='rssi' class='list-value'></span> dB</p>
    </div>

    <script>
        function fetchData() {
            var deviceInfo, wifiInfo;

            function handleRequest() {
                if (this.readyState == 4 && this.status == 200) {
                    var data = JSON.parse(this.responseText);
                    displayData(data, this.responseURL);
                }
            }

            var deviceXhttp = new XMLHttpRequest();
            deviceXhttp.onreadystatechange = handleRequest;
            deviceXhttp.open("GET", "/rest/device-info", true);
            deviceXhttp.send();

            var wifiXhttp = new XMLHttpRequest();
            wifiXhttp.onreadystatechange = handleRequest;
            wifiXhttp.open("GET", "/rest/wifi-info", true);
            wifiXhttp.send();
        }

        function displayData(data, responseUrl) {
            if (responseUrl.includes("device-info")) {
                displayDeviceInfo(data);
            } else if (responseUrl.includes("wifi-info")) {
                displayWifiInfo(data);
            } else {
                console.log("Unknown response URL: " + responseUrl);
                return;
            }
        }

        function displayDeviceInfo(data) {
            document.getElementById('uptime').textContent = data.system.uptime;
            document.getElementById('uptimeDays').textContent = (data.system.uptime/1000.0/60.0/60.0/24.0).toFixed(1);
            document.getElementById('firmwareVersion').textContent = data.firmware.version;
            document.getElementById('firmwareDate').textContent = data.firmware.date;
            document.getElementById('filesystemVersion').textContent = data.filesystem.version;
            document.getElementById('filesystemDate').textContent = data.filesystem.date;
            document.getElementById('heapFree').textContent = (data.memory.heap.free/1000.0).toFixed(1);
            document.getElementById('heapTotal').textContent = (data.memory.heap.total/1000.0).toFixed(1);
            document.getElementById('flashFree').textContent = (data.memory.flash.free/1000.0).toFixed(1);
            document.getElementById('flashTotal').textContent = (data.memory.flash.total/1000.0).toFixed(1);
            document.getElementById('spiffsFree').textContent = (data.memory.spiffs.free/1000.0).toFixed(1);
            document.getElementById('spiffsTotal').textContent = (data.memory.spiffs.total/1000.0).toFixed(1);
            document.getElementById('chipModel').textContent = data.chip.model;
            document.getElementById('chipRevision').textContent = data.chip.revision;
            document.getElementById('chipCpuFrequency').textContent = data.chip.cpuFrequency;
            document.getElementById('chipSdkVersion').textContent = data.chip.sdkVersion;
            document.getElementById('chipFlashChipId').textContent = data.chip.id;
        }

        function displayWifiInfo(data) {
            document.getElementById('macAddress').textContent = data.macAddress;
            document.getElementById('localIp').textContent = data.localIp;
            document.getElementById('subnetMask').textContent = data.subnetMask;
            document.getElementById('gatewayIp').textContent = data.gatewayIp;
            document.getElementById('dnsIp').textContent = data.dnsIp;
            document.getElementById('status').textContent = data.status;
            document.getElementById('ssid').textContent = data.ssid;
            document.getElementById('bssid').textContent = data.bssid;
            document.getElementById('rssi').textContent = data.rssi;
        }

        fetchData();
    </script>
</body>

</html>